#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

require 'uberinstaller'

require 'pry'

puts Dir.pwd

Uberinstaller::Loggable.level = Logger::DEBUG
# # Cnop::Loggable.log_path = File.join('log', "#{Time.now}.log")

# Cnop::Config.google_host = "google.it"
# Cnop::Config.lang = 'it'
# Cnop::Cache.enabled = true


file = '/home/endorama/code/ruby/uberinstaller/tmp/conf.json'

begin
  Uberinstaller::Config.local_pkg_path = File.dirname file unless Uberinstaller::Config.local_pkg_path
  runner = Uberinstaller.new file

  begin
    runner.preprocess
  rescue Exception => e
    puts e
  end

  begin
    runner.install
  rescue Exception => e
    puts e
  end

rescue Uberinstaller::Exception::WrongVersion, Uberinstaller::Exception::WrongArchitecture => e
  exit(127)
end
